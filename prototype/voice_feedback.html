<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¯­éŸ³åé¦ˆ - Mä¼šè®®è®°å½•</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://unpkg.com/typewriter-effect/dist/core.js" />
    <style>
      .analysis-btn {
        background-color: #007aff;
        color: white;
        border: none;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 10px;
        transition: background-color 0.3s;
      }

      .analysis-btn:hover {
        background-color: #0056b3;
      }

      .initial-record-btn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background-color: #dd0000d9;
        border: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.3s;
        box-shadow: 0 0 10px 0 rgba(77, 7, 7, 0.1);
      }

      .initial-record-btn:hover {
        background-color: #ff0000;
        transform: translate(-50%, -50%) scale(1.05);
      }

      .initial-record-btn .record-icon {
        font-size: 32px;
      }

      .meeting-content {
        display: none;
      }

      .meeting-content.active {
        display: block;
      }

      .voice-controls {
        display: none;
      }

      .voice-controls.active {
        display: flex;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>è¯­éŸ³åé¦ˆ</h1>
      <!-- å¯¼èˆªå°†é€šè¿‡ JS åŠ¨æ€æ’å…¥ -->
    </header>

    <button id="initialRecordBtn" class="initial-record-btn">
      <span class="record-icon">ğŸ¤</span>
      <span class="btn-text">å¼€å§‹å½•éŸ³</span>
    </button>

    <main class="meeting-content">
      <div class="meeting-header">
        <div class="meeting-info">
          <h2>ğŸ¯ Mæ–¹æ¡ˆè®¨è®ºä¼šè®®</h2>
        </div>
        <button id="recordBtn" class="record-btn">
          <span class="record-icon">ğŸ¤</span>
          <span class="btn-text">å¼€å§‹å½•éŸ³</span>
        </button>
      </div>

      <div class="conversation-container">
        <div class="conversation-flow">
          <!-- å¯¹è¯å†…å®¹å°†ç”± JS åŠ¨æ€æ’å…¥ -->
        </div>
      </div>

      <div class="voice-controls">
        <button class="control-btn pause">
          <span class="icon">â¸</span>
          <span>æš‚åœ</span>
        </button>
        <div class="audio-progress">
          <div class="progress-bar">
            <div class="progress" style="width: 0%"></div>
          </div>
          <span class="time-stamp">00:00 / 05:00</span>
        </div>
        <button class="control-btn save">
          <span class="icon">ğŸ’¾</span>
          <span>ä¿å­˜</span>
        </button>
      </div>
    </main>

    <script src="js/navigation.js"></script>
    <script src="https://unpkg.com/typewriter-effect/dist/core.js"></script>
    <script src="js/conversation.js"></script>
    <script>
      let recordingStartTime = null;
      let progressInterval = null;

      // æ›´æ–°å½•éŸ³è¿›åº¦
      function updateProgress() {
        if (!recordingStartTime) return;

        const currentTime = new Date();
        const elapsedSeconds = Math.floor((currentTime - recordingStartTime) / 1000);
        const minutes = Math.floor(elapsedSeconds / 60);
        const seconds = elapsedSeconds % 60;

        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        document.querySelector('.time-stamp').textContent = `${timeStr} / 05:00`;

        // æ›´æ–°è¿›åº¦æ¡
        const progressPercent = Math.min((elapsedSeconds / 300) * 100, 100); // æœ€å¤§5åˆ†é’Ÿ
        document.querySelector('.progress').style.width = `${progressPercent}%`;

        // å¦‚æœè¾¾åˆ°5åˆ†é’Ÿï¼Œè‡ªåŠ¨åœæ­¢å½•éŸ³
        if (elapsedSeconds >= 300) {
          stopRecording();
        }
      }

      // å¼€å§‹å½•éŸ³
      function startRecording() {
        // éšè—åˆå§‹å½•éŸ³æŒ‰é’®ï¼Œæ˜¾ç¤ºä¸»ç•Œé¢
        document.getElementById('initialRecordBtn').style.display = 'none';
        document.querySelector('.meeting-content').classList.add('active');
        document.querySelector('.voice-controls').classList.add('active');

        recordingStartTime = new Date();
        document.querySelector('.time-stamp').textContent = '00:00 / 05:00';
        document.querySelector('.progress').style.width = '0%';

        // å¯åŠ¨è¿›åº¦æ›´æ–°å®šæ—¶å™¨
        progressInterval = setInterval(updateProgress, 1000);

        // æ˜¾ç¤ºæš‚åœæŒ‰é’®
        const pauseBtn = document.querySelector('.control-btn.pause');
        pauseBtn.style.display = 'flex';
        pauseBtn.querySelector('.icon').textContent = 'â¸';
        pauseBtn.querySelector('span:not(.icon)').textContent = 'æš‚åœ';
      }

      // åœæ­¢å½•éŸ³
      function stopRecording() {
        recordingStartTime = null;
        clearInterval(progressInterval);

        const recordBtn = document.getElementById('recordBtn');
        recordBtn.classList.remove('recording');
        recordBtn.querySelector('.record-icon').textContent = 'ğŸ¤';
        recordBtn.querySelector('.btn-text').textContent = 'å¼€å§‹å½•éŸ³';

        // éšè—æš‚åœæŒ‰é’®
        document.querySelector('.control-btn.pause').style.display = 'none';
      }

      // æš‚åœ/ç»§ç»­å½•éŸ³
      function togglePause() {
        const pauseBtn = document.querySelector('.control-btn.pause');
        const isPaused = pauseBtn.classList.contains('paused');

        if (isPaused) {
          // ç»§ç»­å½•éŸ³
          recordingStartTime = new Date(
            new Date() - parseFloat(document.querySelector('.progress').style.width) * 3000
          );
          progressInterval = setInterval(updateProgress, 1000);
          pauseBtn.classList.remove('paused');
          pauseBtn.querySelector('.icon').textContent = 'â¸';
          pauseBtn.querySelector('span:not(.icon)').textContent = 'æš‚åœ';
        } else {
          // æš‚åœå½•éŸ³
          clearInterval(progressInterval);
          pauseBtn.classList.add('paused');
          pauseBtn.querySelector('.icon').textContent = 'â–¶';
          pauseBtn.querySelector('span:not(.icon)').textContent = 'ç»§ç»­';
        }
      }

      // åˆå§‹å½•éŸ³æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('initialRecordBtn').addEventListener('click', function () {
        const btn = document.getElementById('recordBtn');
        btn.classList.add('recording');
        btn.querySelector('.record-icon').textContent = 'ğŸ¤';
        btn.querySelector('.btn-text').textContent = 'å½•éŸ³ä¸­...';

        startRecording();
        initializeConversation();
      });

      // å½•éŸ³æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('recordBtn').addEventListener('click', function () {
        const btn = this;

        if (btn.classList.contains('recording')) {
          stopRecording();
        }
      });

      // æš‚åœæŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.querySelector('.control-btn.pause').addEventListener('click', togglePause);

      // åˆå§‹åŒ–æ—¶éšè—æš‚åœæŒ‰é’®
      document.querySelector('.control-btn.pause').style.display = 'none';
    </script>
  </body>
</html>
